CMAKE_MINIMUM_REQUIRED(VERSION 2.8)

IF(DEFINED CMAKE_BUILD_TYPE)
  SET(CMAKE_BUILD_TYPE ${CMAKE_BUILD_TYPE} CACHE STRING "Choose the type of build, options are: None(CMAKE_CXX_FLAGS or CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel.")
ELSE()
  SET(CMAKE_BUILD_TYPE RelWithDebInfo CACHE STRING "Choose the type of build, options are: None(CMAKE_CXX_FLAGS or CMAKE_C_FLAGS used) Debug Release RelWithDebInfo MinSizeRel.")
ENDIF()

PROJECT(jgrok)

IF(CMAKE_INSTALL_PREFIX_INITIALIZED_TO_DEFAULT)
  SET(CMAKE_INSTALL_PREFIX ${EXECUTABLE_OUTPUT_PATH} CACHE PATH "jgrok install prefix" FORCE)
ENDIF()

INCLUDE(CheckIncludeFileCXX)
INCLUDE(CMakeDependentOption)

SET(CMAKE_MODULE_PATH
  ${CMAKE_SOURCE_DIR}
  ${CMAKE_SOURCE_DIR}/cmake/modules
  ${CMAKE_MODULE_PATH}
)

SET(EXECUTABLE_OUTPUT_PATH "${CMAKE_BINARY_DIR}")
SET(LIBRARY_OUTPUT_PATH "${CMAKE_BINARY_DIR}")

ADD_DEFINITIONS("-Wno-unused-result")

IF(WIN32)
  ADD_DEFINITIONS("-D_CRT_SECURE_NO_WARNINGS")
ENDIF()

IF(UNIX)
  ADD_DEFINITIONS("-DENABLE_BINRELOC")
ENDIF()

IF(APPLE)
  SET(CMAKE_MACOSX_RPATH 1)
ENDIF()

# Options
OPTION(JGROK_BUILD_TESTS    OFF "Build the tests")
OPTION(JGROK_BUILD_EXAMPLES OFF "Build the examples")

FIND_PACKAGE(V8 REQUIRED)

INCLUDE_DIRECTORIES(
  ${V8_INCLUDE_DIR}
)

# LINK_DIRECTORIES()

# LINK_LIBRARIES(
#   ${V8_LIBRARY}
#   ${V8_LIBPLATFORM_LIBRARY}
# )

ADD_SUBDIRECTORY(src)

IF (JGROK_BUILD_TESTS)
  ADD_SUBDIRECTORY(test)
ENDIF()

IF (JGROK_BUILD_EXAMPLES)
  ADD_SUBDIRECTORY(examples)
ENDIF()
